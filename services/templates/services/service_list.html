{% extends "base.html" %}
{% block title %}–£—Å–ª—É–≥–∏ ‚Äî Print Coping Services{% endblock %}

{% block content %}

<div class="d-flex flex-column flex-md-row align-items-md-end justify-content-between gap-2 mb-4">
  <div>
    <h1 class="fw-bold mb-1">–ö–∞—Ç–∞–ª–æ–≥ —É—Å–ª—É–≥</h1>
    <p class="text-muted mb-0">–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É –∏ –æ—Å—Ç–∞–≤—å—Ç–µ –∑–∞—è–≤–∫—É ‚Äî –æ—Ç–≤–µ—Ç–∏–º –≤ Telegram –∑–∞ 5‚Äì15 –º–∏–Ω—É—Ç.</p>
  </div>

  <a class="btn btn-dark rounded-4" href="{% url 'orders:create' %}">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</a>
</div>

<div class="row g-4 services-grid">
  {% for s in services %}
  <div class="col-12 col-md-6 col-lg-4">
    <div class="service-card">

      <div class="service-media">
          {% if s.image %}
            <img class="service-img open-photo"
                 src="{{ s.image.url }}"
                 alt="{{ s.title }}"
                 data-full="{{ s.image.url }}">

          {% else %}
            <div class="service-noimg">
              <div class="service-noimg-ico">üñºÔ∏è</div>
              <div class="service-noimg-text">–§–æ—Ç–æ —Å–∫–æ—Ä–æ –¥–æ–±–∞–≤–∏–º</div>
            </div>
          {% endif %}

        <div class="service-badge">–ü–æ–ø—É–ª—è—Ä–Ω–æ</div>
        <div class="service-icon">üñ®Ô∏è</div>
      </div>

      <div class="p-4">
        <h3 class="service-title">{{ s.title }}</h3>

        <p class="service-desc">
          {% if s.description %}
            {{ s.description|truncatechars:110 }}
          {% else %}
            –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ø–µ—á–∞—Ç—å –∏ –±—ã—Å—Ç—Ä–æ–µ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ. –ü–æ–º–æ–∂–µ–º —Å –º–∞–∫–µ—Ç–æ–º –∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏.
          {% endif %}
        </p>

        <div class="service-meta">
          <div class="service-price">
            {% if s.price_from %}
              –æ—Ç {{ s.price_from }} —Å—É–º
            {% else %}
              –¶–µ–Ω–∞ –ø–æ –∑–∞–ø—Ä–æ—Å—É
            {% endif %}
          </div>

          <div class="service-actions">
            <a class="btn btn-primary btn-sm" href="{% url 'orders:create' %}?service={{ s.id }}">–ó–∞–∫–∞–∑–∞—Ç—å</a>
          </div>
        </div>
      </div>

    </div>
  </div>
  {% empty %}
  <div class="col-12">
    <div class="alert alert-warning text-center">
      –£—Å–ª—É–≥ –ø–æ–∫–∞ –Ω–µ—Ç. –î–æ–±–∞–≤—å –∏—Ö –≤ –∞–¥–º–∏–Ω–∫–µ.
    </div>
  </div>
  {% endfor %}
</div>

<!-- PHOTO MODAL -->
<div id="photoModal" class="photo-modal">
  <div class="photo-content">
    <span class="photo-close">&times;</span>
    <img id="modalImage" alt="">
  </div>
</div>

{% endblock %}
{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function () {

  const modal = document.getElementById("photoModal");
  const modalImg = document.getElementById("modalImage");
  const closeBtn = modal?.querySelector(".photo-close");

  function openModal(src){
    if(!modal || !modalImg) return;
    modalImg.src = src;
    modal.classList.add("is-open");
    modal.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden"; // —á—Ç–æ–±—ã —Ñ–æ–Ω –Ω–µ —Å–∫—Ä–æ–ª–ª–∏–ª—Å—è
  }

  function closeModal(){
    if(!modal || !modalImg) return;
    modal.classList.remove("is-open");
    modal.setAttribute("aria-hidden", "true");
    modalImg.src = "";
    document.body.style.overflow = ""; // –≤–µ—Ä–Ω—É—Ç—å —Å–∫—Ä–æ–ª–ª
  }

  // –æ—Ç–∫—Ä—ã—Ç—å –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É
  document.querySelectorAll(".open-photo").forEach(img => {
    img.addEventListener("click", () => openModal(img.dataset.full));
  });

  // –∑–∞–∫—Ä—ã—Ç—å –ø–æ –∫—Ä–µ—Å—Ç–∏–∫—É
  closeBtn?.addEventListener("click", closeModal);

  // –∑–∞–∫—Ä—ã—Ç—å –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω (–ù–ï –Ω–∞ –∫–∞—Ä—Ç–∏–Ω–∫—É)
  modal?.addEventListener("click", (e) => {
    if(e.target === modal) closeModal();
  });

  // –∑–∞–∫—Ä—ã—Ç—å –ø–æ Esc
  document.addEventListener("keydown", (e) => {
    if(e.key === "Escape") closeModal();
  });

});
</script>
{% endblock %}